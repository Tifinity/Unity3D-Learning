# ç®€å•å·¡é€»å…µ

[TOC]

## æ¸¸æˆè§„åˆ™ä¸è¦æ±‚

- æ™ºèƒ½å·¡é€»å…µ
  - æ¸¸æˆè®¾è®¡è¦æ±‚ï¼š
    - åˆ›å»ºä¸€ä¸ªåœ°å›¾å’Œè‹¥å¹²å·¡é€»å…µ(ä½¿ç”¨åŠ¨ç”»)ï¼›
    - æ¯ä¸ªå·¡é€»å…µèµ°ä¸€ä¸ª3~5ä¸ªè¾¹çš„å‡¸å¤šè¾¹å‹ï¼Œä½ç½®æ•°æ®æ˜¯ç›¸å¯¹åœ°å€ã€‚å³æ¯æ¬¡ç¡®å®šä¸‹ä¸€ä¸ªç›®æ ‡ä½ç½®ï¼Œç”¨è‡ªå·±å½“å‰ä½ç½®ä¸ºåŸç‚¹è®¡ç®—ï¼›
    - å·¡é€»å…µç¢°æ’åˆ°éšœç¢ç‰©ï¼Œåˆ™ä¼šè‡ªåŠ¨é€‰ä¸‹ä¸€ä¸ªç‚¹ä¸ºç›®æ ‡ï¼›
    - å·¡é€»å…µåœ¨è®¾å®šèŒƒå›´å†…æ„ŸçŸ¥åˆ°ç©å®¶ï¼Œä¼šè‡ªåŠ¨è¿½å‡»ç©å®¶ï¼›
    - å¤±å»ç©å®¶ç›®æ ‡åï¼Œç»§ç»­å·¡é€»ï¼›
    - è®¡åˆ†ï¼šç©å®¶æ¯æ¬¡ç”©æ‰ä¸€ä¸ªå·¡é€»å…µè®¡ä¸€åˆ†ï¼Œä¸å·¡é€»å…µç¢°æ’æ¸¸æˆç»“æŸï¼›
  - ç¨‹åºè®¾è®¡è¦æ±‚ï¼š
    - å¿…é¡»ä½¿ç”¨è®¢é˜…ä¸å‘å¸ƒæ¨¡å¼ä¼ æ¶ˆæ¯
      - subjectï¼šOnLostGoal
      - Publisher: GameEventManager
      - Subscriber: åœºæ™¯æ§åˆ¶å™¨
    - å·¥å‚æ¨¡å¼ç”Ÿäº§å·¡é€»å…µ

## é¡¹ç›®åœ°å€ä¸æ¼”ç¤ºè§†é¢‘

é¡¹ç›®åœ°å€ -> [ä¼ é€é—¨ğŸšª](https://github.com/Tifinity/Unity3DStudy-master/tree/master/%E9%A1%B9%E7%9B%AE%E5%85%AD%EF%BC%9A%E7%AE%80%E5%8D%95%E6%89%93%E9%A3%9E%E7%A2%9F%EF%BC%88%E7%89%A9%E7%90%86%E5%BC%95%E6%93%8E%EF%BC%89)

è§†é¢‘è¿æ¥ -> [ä¼ é€é—¨ğŸšª]( https://www.bilibili.com/video/av73465390/ )



## å…·ä½“å®ç°

åŸºæœ¬é€»è¾‘ï¼šç©å®¶é€šè¿‡é”®ç›˜æ§åˆ¶äººç‰©åœ¨åœ°å›¾ä¸Šç§»åŠ¨ï¼Œåœ°å›¾åˆ†ä¸ºä¹ä¸ªéƒ¨åˆ†ï¼Œæœ‰å…«ä¸ªå·¡é€»å…µåœ¨å‡ºç”Ÿç‚¹ä»¥å¤–çš„éƒ¨åˆ†å·¡é€»ï¼Œå½“ç©å®¶è¿›å…¥ä¸€ä¸ªéƒ¨åˆ†æ—¶è¯¥éƒ¨åˆ†çš„å·¡é€»å…µå°±ä¼šè¿½é€ç©å®¶ï¼Œè‹¥ç©å®¶ç”©å¼€å·¡é€»å…µåˆ™åˆ†æ•°åŠ ä¸€ï¼Œè‹¥ç©å®¶ä¸å·¡é€»å…µè§¦ç¢°åˆ™æ¸¸æˆç»“æŸã€‚

ç”±äºæœ¬æ¬¡é¡¹ç›®ä»£ç é‡æ¯”è¾ƒå¤§ï¼Œæ¡†æ¶éƒ¨åˆ†è¿˜æ˜¯é‡ç”¨ä¹‹å‰å†™çš„ä»£ç ï¼Œåœ¨æ­¤åªå™è¿°é‡ç‚¹éƒ¨åˆ†ã€‚

æœ¬ç« æ ‡é¢˜æ˜¯åŠ¨ç”»ä¸æ¨¡å‹ï¼Œäºæ˜¯æˆ‘å°†é‡ç‚¹æ”¾åœ¨äº†äººç‰©æ¨¡å‹ä¸åŠ¨ç”»ä¸Šã€‚

æˆ‘æ‰€ä½¿ç”¨çš„æ¨¡å‹ç´ æï¼š[ğŸšª](https://share.weiyun.com/5vZ22uQ)

### Unity3Då°æŠ€å·§ï¼š

- çª—å£æ˜¯å¯ä»¥é”å®šçš„ï¼š

  å½“ä½ åˆ¶ä½œé¢„åˆ¶ä½“éœ€è¦æŠŠè„šæœ¬æ‹–åˆ°æ£€æŸ¥å™¨ä¸­æ—¶ï¼ŒæŒ‰ä¸€ä¸‹çª—å£å³ä¸Šè§’çš„é”å°±å¯ä»¥é”å®šçª—å£ï¼Œé€‰ä¸­å…¶ä»–å¯¹è±¡æ£€æŸ¥å™¨ä¹Ÿä¸ä¼šå˜ï¼Œå‘Šåˆ«æ‰‹æ®‹Â·~Â·

- å»æ‰è½®å»“ï¼š

  æœ‰æ—¶å¸ƒç½®åœºæ™¯æ—¶æ„Ÿè§‰å¯¹è±¡å›¾æ ‡å’Œè½®å»“å¤ªç¢äº‹ï¼Œå»æ‰ä»–ä»¬ï¼

  Gizmos->è°ƒæ•´å›¾æ ‡å¤§å°ï¼Œæ˜¾ç¤ºè½®å»“ç½‘æ ¼é€‰æ‹©çº¿ã€‚

  ![è½®å»“](T:\TH\å¤§ä¸‰ä¸Š\3Dæ¸¸æˆè®¾è®¡\7æ¨¡å‹ä¸åŠ¨ç”»\image\è½®å»“.jpg)

### äººç‰©æ¨¡å‹éƒ¨åˆ†ï¼š

ç”±äºè¿™éƒ¨åˆ†å†…å®¹æ¯”è¾ƒå¤šæ”¾åœ¨äº†å¦ä¸€ç¯‡åšå®¢ä¸­ï¼š[ğŸšª]()

äººç‰©æ¨¡å‹å¦‚ä¸‹ï¼š

![player](T:\TH\å¤§ä¸‰ä¸Š\3Dæ¸¸æˆè®¾è®¡\7æ¨¡å‹ä¸åŠ¨ç”»\image\player.jpg)

äººç‰©åŠ¨ç”»å™¨å¦‚ä¸‹ï¼Œä¸€ä¸ªLayeräº”ä¸ªåŠ¨ä½œï¼š

![1572069043313](C:\Users\TIFINITY\AppData\Roaming\Typora\typora-user-images\1572069043313.png)



### å·¡é€»å…µéƒ¨åˆ†ï¼š

å·¡é€»å…µä¸ç©å®¶ä½¿ç”¨åŒä¸€ä¸ªæ¨¡å‹å’ŒåŠ¨ç”»å™¨ï¼Œä¸è¿‡é€šè¿‡ä»£ç æ§åˆ¶å…¶åªæœ‰è¡Œèµ°å’Œå¥”è·‘ä¸¤ä¸ªåŠ¨ä½œï¼Œå·¡é€»æ—¶è¡Œèµ°ï¼Œè¿½é€ç©å®¶æ—¶å¥”è·‘ã€‚

![guard](T:\TH\å¤§ä¸‰ä¸Š\3Dæ¸¸æˆè®¾è®¡\7æ¨¡å‹ä¸åŠ¨ç”»\image\guard.png)

å·¡é€»å…µçš„ç§»åŠ¨ç­–ç•¥æ˜¯å‚è€ƒ[C486Cå¸ˆå…„(å¸ˆå§ï¼Ÿ)åšå®¢]( https://blog.csdn.net/c486c/article/details/80153548 )çš„ï¼Œä¸è¿‡å¸ˆå…„æ‰€æœ‰çš„åŠ¨ä½œéƒ½æ˜¯ä½¿ç”¨è¿åŠ¨å­¦çš„å‡½æ•°MoveTowardsæ¥å®ç°å¹¶ä¸”ä½¿ç”¨Updateæ¥æ›´æ–°ï¼Œè€Œå·¡é€»å…µæ˜¯åˆšä½“ä¸”æ²¡æœ‰å‹¾é€‰è¿åŠ¨å­¦ï¼Œæˆ‘è®¤ä¸ºä½¿ç”¨è¿åŠ¨å­¦çš„å‡½æ•°æ¥ç§»åŠ¨åˆšä½“æ˜¯ä¸å¤ªå¥½çš„ï¼Œæ‰€ä»¥æ”¹ä¸ºç‰©ç†å¼•æ“çš„ç§»åŠ¨æ–¹å¼å¹¶ä¸”ä½¿ç”¨FixedUpdateæ¥æ›´æ–°ï¼›å¦ä¸€ç‚¹æ˜¯å¸ˆå…„å°†æœ¬æ¬¡å·¡é€»å…µçš„ä¸¤ä¸ªåŠ¨ä½œåˆ‡æ¢å†™åœ¨äº†åŠ¨ä½œç®¡ç†å™¨åŸºç±»SSActionManagerä¸­ï¼Œæˆ‘è®¤ä¸ºåº”è¯¥åœ¨å·¡é€»å…µçš„åŠ¨ä½œç®¡ç†å™¨ä¸­GuardActionManagerä¸­å®ç°è¯¥åŠŸèƒ½ã€‚

ä»¥ä¸‹åˆ†æéƒ¨åˆ†ä»£ç ï¼š

- GuardPatrolActionï¼š

  Updateåªæ›´æ–°å¹³é¢ç§»åŠ¨çš„å‘é‡ï¼ŒFixedUpdateä½¿ç”¨è¯¥å‘é‡è¿›è¡Œç§»åŠ¨ï¼Œé€šè¿‡ä¿®æ”¹rigidçš„velocityæ¥ç§»åŠ¨ã€‚

  ~~~C#
  /*å˜é‡*/
  private Rigidbody rigid;    //åˆšä½“ç»„ä»¶
  private Vector3 planarVec;  // å¹³é¢ç§»åŠ¨å‘é‡
  
  /*æ›´æ–°å‡½æ•°*/
  public override void Update() {
      //ä¿ç•™ä¾›ç‰©ç†å¼•æ“è°ƒç”¨
      planarVec = gameobject.transform.forward * data.walkSpeed;
  }
  
  public override void FixedUpdate() {
      //å·¡é€»
      Gopatrol();
      //ç©å®¶è¿›å…¥è¯¥åŒºåŸŸï¼Œå·¡é€»ç»“æŸï¼Œå¼€å§‹è¿½é€
      if (data.playerSign == data.sign) {
          this.destroy = true;
          this.callback.SSActionEvent(this, SSActionEventType.Competeted, 0, this.gameobject);
      }
  }
  
  /*in Gopatrol()*/
  rigid.velocity = new Vector3(planarVec.x, rigid.velocity.y, planarVec.z);
  ~~~

- GuardFollowAction:

  ä¸GuardPatrolActionç›¸åŒï¼Œæ”¹ä¸ºç‰©ç†å¼•æ“çš„æ–¹å¼ã€‚

  ~~~c#
   public override void Update() {
       //ä¿ç•™ä¾›ç‰©ç†å¼•æ“è°ƒç”¨
       planarVec = gameobject.transform.forward * speed;
   }
  
  public override void FixedUpdate() {
      transform.LookAt(player.transform.position);
      rigid.velocity = new Vector3(planarVec.x, rigid.velocity.y, planarVec.z);
  
      //å¦‚æœç©å®¶è„±ç¦»è¯¥åŒºåŸŸåˆ™ç»§ç»­å·¡é€»
      if (data.playerSign != data.sign) {
          this.destroy = true;
          this.callback.SSActionEvent(this, SSActionEventType.Competeted, 1, this.gameobject);
      }
  }
  ~~~

- GuardActionManagerï¼š

  ä¸»è¦å®ç°å·¡é€»å…µåŠ¨ä½œåˆ‡æ¢çš„åŠŸèƒ½ï¼Œå®ç°å›è°ƒå‡½æ•°SSActionEventï¼Œå½“ä¸€ä¸ªåŠ¨ä½œè¢«é”€æ¯æ—¶è°ƒç”¨å¦ä¸€ä¸ªåŠ¨ä½œã€‚

  ~~~c#
  public void SSActionEvent(
      SSAction source, SSActionEventType events = SSActionEventType.Competeted,
      int intParam = 0, GameObject objectParam = null) {
      if (intParam == 0) {
          //è¿½é€
          GuardFollowAction follow = GuardFollowAction.GetSSAction(player);
          this.RunAction(objectParam, follow, this);
      } else {
          //å·¡é€»
          GuardPatrolAction move = GuardPatrolAction.GetSSAction(objectParam.gameObject.GetComponent<GuardData>().start_position);
          this.RunAction(objectParam, move, this);
          Singleton<GameEventManager>.Instance.PlayerEscape();
      }
  }
  ~~~




### åœ°å›¾éƒ¨åˆ†ï¼š

åœ°å›¾åˆ†ä¸ºä¹ä¸ªæ ¼å­ï¼Œæ¯ä¸ªåŒºåŸŸæœ‰è‡ªå·±çš„ç¢°æ’å™¨ï¼Œå¹¶æŒ‚è½½AreaCollide.csã€‚

![map](T:\TH\å¤§ä¸‰ä¸Š\3Dæ¸¸æˆè®¾è®¡\7æ¨¡å‹ä¸åŠ¨ç”»\image\map.jpg)

![åœ°å›¾ç¢°æ’å™¨](T:\TH\å¤§ä¸‰ä¸Š\3Dæ¸¸æˆè®¾è®¡\7æ¨¡å‹ä¸åŠ¨ç”»\image\åœ°å›¾ç¢°æ’å™¨.jpg)



- AreaCollideï¼š

  å½“ç©å®¶è¿›å…¥æ—¶è®¾ç½®åœºæ™¯æ§åˆ¶å™¨ä¸­çš„ç©å®¶åŒºåŸŸæ ‡å¿—ï¼Œç„¶ååœºæ™¯æ§åˆ¶å™¨é€šçŸ¥å¯¹åº”çš„å·¡é€»å…µè¿½é€ç©å®¶ã€‚

~~~C#
public class AreaCollide : MonoBehaviour {
    public int sign = 0;
    private FirstSceneController sceneController;

    private void Start() {
        sceneController = SSDirector.GetInstance().CurrentScenceController as FirstSceneController;
    }
	
    void OnTriggerEnter(Collider collider) {
        if (collider.gameObject.tag == "Player") {
            sceneController.playerSign = sign;
        }
    }
}
~~~



### è§‚å¯Ÿè€…æ¨¡å¼ï¼š

- GameEventManagerå‘å¸ƒæ¶ˆæ¯ï¼š

  ~~~c#
  public class GameEventManager : MonoBehaviour {
      //å®šä¹‰å›è°ƒå‡½æ•°ç±»å‹å’Œsubject
      public delegate void ScoreEvent();
      public static event ScoreEvent ScoreChange;
      
      public delegate void GameoverEvent();
      public static event GameoverEvent GameoverChange;
  	
      public void PlayerEscape() {
          if (ScoreChange != null) {
              ScoreChange();
          }
      }
  
      public void PlayerGameover(){
          if (GameoverChange != null) {
              GameoverChange();
          }
      }
  }
  ~~~

- FirstSenceControllerç±»è®¢é˜…æ¶ˆæ¯ï¼š

  ~~~c#
  void OnEnable() {
      GameEventManager.ScoreChange += AddScore;
      GameEventManager.GameoverChange += Gameover;
  }
  void OnDisable() {
      GameEventManager.ScoreChange -= AddScore;
      GameEventManager.GameoverChange -= Gameover;
  }
  
  void AddScore() {
      recorder.AddScore();
  }
  
  void Gameover() {
      game_over = true;
  }
  ~~~

  




## æ€»ç»“

æœ¬æ¬¡ä½œä¸šä¸»è¦æ˜¯äº†è§£äº†ç‰©ç†å¼•æ“åœ¨Unity3Dä¸­çš„ä½¿ç”¨ï¼ŒåŒ…æ‹¬FixedUpdateå‡½æ•°ï¼Œåˆšä½“ç»„ä»¶ï¼Œå¯¹æ¸¸æˆå¯¹è±¡é€Ÿåº¦å’ŒåŠ›çš„æ“ä½œï¼Œä½¿ç”¨ç‰©ç†å¼•æ“å°±ä¸éœ€è¦æ¨¡æ‹Ÿè¿åŠ¨å­¦çš„ä½ç½®å˜æ¢ï¼Œä½¿ç”¨å¤æ‚çš„å…¬å¼è®¡ç®—ã€‚æ€»çš„æ¥è¯´è¿‡ç¨‹æ¯”è¾ƒé¡ºåˆ©ï¼Œæ²¡æœ‰å¤ªå¤§çš„é˜»ç¢ã€‚



## å‚è€ƒèµ„æ–™

[ä¼˜ç§€åšå®¢ C486C](https://blog.csdn.net/c486c/article/details/80153548#%E7%AE%80%E5%8D%95%E5%B7%A1%E9%80%BB%E5%85%B5)